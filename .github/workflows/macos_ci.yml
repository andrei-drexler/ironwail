name: macOS CI
on: [push, pull_request]
jobs:
  build:
    name: macOS
    runs-on: macos-12
    strategy:
      fail-fast: false
    steps:
    - uses: actions/checkout@v4
    - name: Install Dependencies
      run: |
        brew install cmake libvorbis libxmp sdl2 libmpg123 libmad flac opusfile
    - name: Build Carnifex Engine
      run: make
    - name: Test Engine
      run: |
        # Basic smoke test - check if engine starts without crashing
        timeout 10s ./build-artifacts/carnifex-engine -game carnifex-game -dev || true
    - name: Upload Build Artifacts
      if: github.ref == 'refs/heads/carnifex' && github.event_name != 'pull_request'
      uses: actions/upload-artifact@v4
      with:
        name: carnifex-macos
        path: build-artifacts/carnifex-engine
